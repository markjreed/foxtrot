#!/usr/bin/env bash
# given a version number and semver level, bump that level
main() {
  if (( $# != 2 )); then
    printf >&2 'Usage: %s version level\n' "$0"
    exit 1
  fi
  local old=$1 level=$2
  if [[ ! "$old" =~ ^v?[0-9]+\.[0-9][0-9.]*$ ]]; then
    printf >&2 '%s: invalid version string "%s"\n' "$0" "$old"
    exit 1
  fi
  local index
  case "$level" in
    major) index=0;;
    minor) index=1;;
    patch) index=2;;
    *) printf >&2 '%s: invalid semver level "%s"\n' "$0" "$level"; exit 1;;
  esac

  local prefix=${old%%${old#v}}
  local version
  mapfile -d. -t version <<<"${old#v}"
  (( version[index]++ ))
  local i
  for (( i=index+1; i<${#version[@]}; ++i )); do
    version[i]=0
  done
  printf '%s%s' "$prefix" "${version[0]}"
  printf '.%s' "${version[@]:1}"
  printf '\n'
}

main "$@"
